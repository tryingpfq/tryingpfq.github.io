---
layout:     post
title:      分布式
subtitle:   分布式知识相关
date:       2020-03-20
author:     tryingpfq
header-img: img/post-bg-fenbushi.jpeg
catalog: true
tags:
    - 分布式
---

### 分布式



#### dubbo

> 看dubbo源码，记录一些问题，首先必须说的是很复杂，先要搞懂的是各个模块之间的依赖



##### dubbo 模块：各个模块功能简介

* 配置中心(dubbo-config)

* 注册中心(dubbo-register)

  dubbo中，基本所有服务都是通过配置进行的，这里可以了解下(org.apache.dubbo.config.ServerConfig),提供方会把提供的服务注册到注册中心，告诉注册中心自己可以提供哪些服务。

  一般我们把注册中心放到Zookeeper上去，所以需要修改注册中心地址

  > resources/spring/dubbo-provider.xml 修改其中的dubbo:registry，替换成真实的注册中心地址，推荐使用zookeeper，如： <dubbo:registry address="zookeeper://127.0.0.1:2181"/>

  

  * 下面看下Provider注册服务的过程

    主要的启动是org.apache.dubbo.config.bootstrap.start()，方法，这是服务注册的启动方法。顺着这个方法往下看，就会进入到ServerConfig.exported()方法，在bootstrap.configManager中开始就加载了服务配置，然后遍历去进行注册。然后会进入到ServerConfig#export()方法,基本准备工作都是在ServerConfig中完成的。然后统一会进入到doExportUrlsFor1Protocol()这个复杂的方法中，最后会把服务注册到org.apache.dubbo.registry.support.AbstractRegistryFactory#REGISTRIES属性中。

    这里就是provider的一个注册过程，但里面复杂的东西就没看，比如Config如何配置加载、宕机是如何处理的等等问题

  * Consumer在启动的时候，是如何向注册中心订阅自己需要的服务

    首先也是要配置，需要订阅哪些服务，然后消费端的启动类BootStrap中会有个ReferenceConfigCache#cache，最后会去订阅，可以看下RegistryProtocol的refer->dorefer->

    里面就能看到directory.subscribe(toSubscribeUrl(subscribeUrl))。

    

* dubbo-monitor：监控中心

* dubbo-container 容器

* dubbo-remoting

* dubbo-rpc

* dubbo-cluster 路由和负载均衡策略

* dubbo-demo 使用实例